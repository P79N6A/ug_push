webpackJsonp([27],{DYyz:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("mvHQ"),s=i.n(a),n=i("Dd8w"),o=i.n(n),l=i("vzON"),r=i("zL8q"),c=i("NYxO"),d=i("0xDb"),m={name:"itemList",props:["item","index","callback"],data:function(){return{dialogVisible:!1,data:null,isShowFull:!1,fullLink:"",imgObj:{},fileList:[],text:""}},computed:o()({},Object(c.b)(["email"])),methods:{init:function(){this.item&&(this.data=JSON.parse(s()(this.item)),this.text=this.item.description&&this.item.description.text?this.item.description.text.replace(/\<br \/\>/g,"\n"):"")},_parseTime:function(t,e){return Object(d.e)(t,e)},handleUpdate:function(){this.fileList=[],this.imgObj={},this.init(),this.dialogVisible=!0},updateEvent:function(){var t=this;this.data.title?this.text?this.data.event_date?0!==this.data.img.length||"{}"!=s()(this.imgObj)?this.$confirm("将保存修改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){t.updateAction()}).catch(function(){t.$message({type:"info",message:"已取消添加！"})}):Object(r.Message)({showClose:!0,message:"请上传监控图！",type:"error",duration:3e3}):Object(r.Message)({showClose:!0,message:"请选择事件发生日期时间！",type:"error",duration:3e3}):Object(r.Message)({showClose:!0,message:"请填写事件描述！",type:"error",duration:3e3}):Object(r.Message)({showClose:!0,message:"请填写标题！",type:"error",duration:3e3})},updateAction:function(){var t=this,e=JSON.parse(s()(this.data.img));for(var i in this.imgObj)e.push(this.imgObj[i]);var a={text:this.text},n=new URLSearchParams;n.append("id",this.data.id),n.append("title",this.data.title),n.append("event_date",this.data.event_date),n.append("description",s()(a)),n.append("img",s()(e)),n.append("username",this.email),n.append("cip",230);var o={url:"/event/editEvent",params:n};this.$store.dispatch("CommonPost",o).then(function(e){e.code&&200==Number(e.code)?(t.dialogVisible=!1,t.callback()):Object(r.Message)({showClose:!0,message:e.msg||"操作失败！",type:"error",duration:3e3})},function(t){Object(r.Message)({showClose:!0,message:"操作接口请求失败！",type:"error",duration:3e3})})},showFullImg:function(t){t?(this.fullLink=t,this.isShowFull=!0):this.isShowFull=!1},handleDeleteImg:function(t){this.data.img.splice(t,1)},handleRemove:function(t,e){this.imgObj.hasOwnProperty(t.uid)&&delete this.imgObj[t.uid]},handleFile:function(t){this.blobToDataURL(t.url,t.uid,this.setImgUrl)},setImgUrl:function(t,e){this.imgObj[e]=t},blobToDataURL:function(t,e,i){fetch(t).then(function(t){return t.blob()}).then(function(t){var a=new window.FileReader;a.onloadend=function(){var t=a.result;i(t,e)},a.readAsDataURL(t)})}},created:function(){this.init()},watch:{item:function(){this.init()}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.item?i("el-row",[i("el-col",{staticClass:"item-wrapper",attrs:{xs:24,sm:23,md:23,lg:23,xl:23}},[i("el-row",{staticClass:"clearfix"},[i("span",[t._v("No."+t._s(t.index))]),t._v(" "),i("span",{staticClass:"item-title"},[t._v(t._s(t.item.title||"暂无"))]),t._v(" "),t.data?i("el-button",{staticClass:"right",attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(e){t.handleUpdate()}}},[t._v("编辑")]):t._e()],1),t._v(" "),i("el-dialog",{attrs:{title:"编辑大事件",visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{"label-position":"left",size:"small"}},[i("el-form-item",{attrs:{label:"标题",required:""}},[i("el-input",{staticStyle:{"max-width":"360px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入大事件标题",clearable:""},model:{value:t.data.title,callback:function(e){t.$set(t.data,"title","string"==typeof e?e.trim():e)},expression:"data.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"描述",required:""}},[i("el-input",{staticStyle:{"max-width":"360px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入简要描述大事件",clearable:""},model:{value:t.text,callback:function(e){t.text="string"==typeof e?e.trim():e},expression:"text"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"时间",required:""}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"timestamp"},model:{value:t.data.event_date,callback:function(e){t.$set(t.data,"event_date",e)},expression:"data.event_date"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"监控图",required:""}},[t._l(t.data.img,function(e,a){return i("div",{key:a,staticClass:"left edit-img-box"},[i("img",{staticClass:"edit-img",attrs:{src:e,alt:t.data.title}}),t._v(" "),i("div",{staticClass:"edit-img-mask"},[i("i",{staticClass:"el-icon-delete edit-img-delete",on:{click:function(e){t.handleDeleteImg(a)}}})])])}),t._v(" "),i("el-upload",{attrs:{action:"",accept:"image/jpeg,image/png","on-change":t.handleFile,"on-remove":t.handleRemove,"list-type":"picture-card","auto-upload":!1,"file-list":t.fileList}},[i("i",{staticClass:"el-icon-plus"}),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])])],2)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateEvent()}}},[t._v("保 存")])],1)],1),t._v(" "),i("el-row",{staticClass:"info-box"},[i("span",{staticClass:"item-info"},[t._v(t._s(t._parseTime(t.item.event_date)))])]),t._v(" "),i("el-row",[i("p",{staticClass:"content-text",domProps:{innerHTML:t._s(t.item.description&&t.item.description.text?t.item.description.text:"暂无描述")}})]),t._v(" "),t.item.img&&t.item.img.length>0?i("el-row",{staticClass:"img-wrapper"},t._l(t.item.img,function(e,a){return i("el-col",{key:a,attrs:{md:12,span:24}},[i("div",{staticClass:"img-box",attrs:{href:e,target:"_blank",title:"查看原图"},on:{click:function(i){t.showFullImg(e)}}},[i("img",{attrs:{src:e,alt:t.item.title}})])])})):t._e()],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowFull,expression:"isShowFull"}],staticClass:"img-full-box",style:"background-image: url("+t.fullLink+")",on:{click:function(e){t.showFullImg()}}})],1):t._e()},staticRenderFns:[]};var p=i("VU/8")(m,u,!1,function(t){i("VNXL")},"data-v-c157c7ac",null).exports,h={name:"datamonitor",components:{Auth:l.a,ItemList:p},data:function(){return{datalist:null,pickerOptions:{disabledDate:function(t){return t.getTime()+36e5>Date.now()},shortcuts:[{text:"昨天",onClick:function(t){var e=new Date;e.setTime(e.getTime()-864e5),t.$emit("pick",e)}},{text:"一周前",onClick:function(t){var e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",e)}}]},dialogVisible:!1,formInline:{page:1,count:2},formAdd:{title:"",event_date:"",img:[],description:{}},text:"",total:0,imgObj:{},fileList:[]}},computed:o()({},Object(c.b)(["pageAuth","email"])),methods:{init:function(){1===this.pageAuth&&this.onSearch()},onSearch:function(){var t=this,e={url:"/event/getEventList",params:o()({},this.formInline,{username:this.email,cip:230})};this.$store.dispatch("CommonGet",e).then(function(e){e.code&&200==Number(e.code)?(Object(r.Message)({showClose:!0,message:"success",type:"success",duration:1e3}),t.datalist=e.result||"",t.total=e.total):Object(r.Message)({showClose:!0,message:e.msg||"查询失败",type:"error",duration:3e3})},function(t){Object(r.Message)({showClose:!0,message:"查询接口请求失败",type:"error",duration:3e3})})},handleSizeChange:function(t){this.formInline.count=t,this.onSearch()},handleCurrentChange:function(t){this.formInline.page=t,this.onSearch()},handleRemove:function(t,e){this.imgObj.hasOwnProperty(t.uid)&&delete this.imgObj[t.uid]},handleFile:function(t){this.blobToDataURL(t.url,t.uid,this.setImgUrl)},setImgUrl:function(t,e){this.imgObj[e]=t},addEvent:function(){var t=this;this.formAdd.title?this.text?(this.formAdd.description.text=this.text,this.formAdd.event_date?"{}"!=s()(this.imgObj)?this.$confirm("将添加大事件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){t.addAction()}).catch(function(){t.$message({type:"info",message:"已取消添加！"})}):Object(r.Message)({showClose:!0,message:"请上传监控图！",type:"error",duration:3e3}):Object(r.Message)({showClose:!0,message:"请选择事件发生日期时间！",type:"error",duration:3e3})):Object(r.Message)({showClose:!0,message:"请填写事件描述！",type:"error",duration:3e3}):Object(r.Message)({showClose:!0,message:"请填写标题！",type:"error",duration:3e3})},addAction:function(){var t=this;for(var e in this.formAdd.img=[],this.imgObj)this.formAdd.img.push(this.imgObj[e]);var i=new URLSearchParams;i.append("title",this.formAdd.title),i.append("event_date",this.formAdd.event_date),i.append("description",s()(this.formAdd.description)),i.append("img",s()(this.formAdd.img)),i.append("username",this.email),i.append("cip",230);var a={url:"/event/addEvent",params:i};this.$store.dispatch("CommonPost",a).then(function(e){e.code&&200==Number(e.code)?(t.dialogVisible=!1,t.onSearch()):Object(r.Message)({showClose:!0,message:e.msg||"操作失败！",type:"error",duration:3e3})},function(t){Object(r.Message)({showClose:!0,message:"操作接口请求失败！",type:"error",duration:3e3})})},blobToDataURL:function(t,e,i){fetch(t).then(function(t){return t.blob()}).then(function(t){var a=new window.FileReader;a.onloadend=function(){var t=a.result;i(t,e)},a.readAsDataURL(t)})},handleAdd:function(){this.fileList=[],this.imgObj={},this.formAdd={title:"",event_date:"",img:[],description:{}},this.text="",this.dialogVisible=!0}},created:function(){this.init()},watch:{pageAuth:function(){this.init()}}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return 1===t.pageAuth?i("el-main",[i("el-row",{staticClass:"pane-title-wrap clearfix"},[i("h6",{staticClass:"pane-title left"},[i("i",{staticClass:"el-icon-date hidden-xs-only",staticStyle:{"margin-right":"6px"}}),t._v("大事件追溯")]),t._v(" "),i("el-button",{staticClass:"right",attrs:{type:"success",plain:"",size:"mini"},on:{click:function(e){t.handleAdd()}}},[t._v("添加")])],1),t._v(" "),i("el-dialog",{attrs:{title:"添加大事件",visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{model:t.formAdd,"label-position":"left",size:"small"}},[i("el-form-item",{attrs:{label:"标题",required:""}},[i("el-input",{staticStyle:{"max-width":"360px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入大事件标题",clearable:""},model:{value:t.formAdd.title,callback:function(e){t.$set(t.formAdd,"title","string"==typeof e?e.trim():e)},expression:"formAdd.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"描述",required:""}},[i("el-input",{staticStyle:{"max-width":"360px"},attrs:{type:"textarea",autosize:"",placeholder:"请输入简要描述大事件",clearable:""},model:{value:t.text,callback:function(e){t.text="string"==typeof e?e.trim():e},expression:"text"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"时间",required:""}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"timestamp"},model:{value:t.formAdd.event_date,callback:function(e){t.$set(t.formAdd,"event_date",e)},expression:"formAdd.event_date"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"监控图",required:""}},[i("el-upload",{attrs:{action:"",accept:"image/jpeg,image/png","on-change":t.handleFile,"on-remove":t.handleRemove,"list-type":"picture-card","auto-upload":!1,"file-list":t.fileList}},[i("i",{staticClass:"el-icon-plus"}),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.addEvent()}}},[t._v("添 加")])],1)],1),t._v(" "),i("el-row",{staticClass:"content-box-wrap"},[t.datalist?i("el-col",{attrs:{span:24}},[t._l(t.datalist,function(e,a){return i("item-list",{key:e.id,attrs:{callback:t.onSearch,item:e,index:(t.formInline.page-1)*t.formInline.count+a+1}})}),t._v(" "),i("div",{staticStyle:{"padding-top":"10px",overflow:"auto"}},[i("el-pagination",{attrs:{"current-page":t.formInline.page,"page-sizes":[2,5,10],"page-size":2,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],2):t._e()],1)],1):0===t.pageAuth?i("el-main",[i("auth")],1):t._e()},staticRenderFns:[]};var g=i("VU/8")(h,f,!1,function(t){i("RVMB")},"data-v-d061e11c",null);e.default=g.exports},RVMB:function(t,e){},VNXL:function(t,e){}});