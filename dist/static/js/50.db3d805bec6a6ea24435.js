webpackJsonp([50],{Gu7T:function(e,t,i){"use strict";t.__esModule=!0;var a,l=i("c/Tr"),s=(a=l)&&a.__esModule?a:{default:a};t.default=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return(0,s.default)(e)}},"h/Ch":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("lHA8"),l=i.n(a),s=i("Gu7T"),o=i.n(s),r=i("Dd8w"),n=i.n(r),d=i("NYxO"),c=(i("0xDb"),i("zL8q")),u=i("vzON"),f={name:"operateWhite",data:function(){return{dialogVisible:!1,prefix:[]}},computed:n()({},Object(d.b)(["email"])),props:["data","apiconf","callback"],methods:{init:function(){if(this.prefix=[],this.data.account&&this.data.account.length>0)for(var e=0;e<this.data.account.length;e++)this.prefix.push(this.data.account[e].email_prefix)},setEvent:function(){var e=this,t={url:this.apiconf.setRoleAccount,params:{role_id:this.data.id,prefix:this.prefix.join(","),username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)?(Object(c.Message)({showClose:!0,message:"保存成功！",type:"success",duration:1e3}),e.dialogVisible=!1,e.callback()):Object(c.Message)({showClose:!0,message:t.msg||"保存失败!",type:"error",duration:0})})},cancelEvent:function(){this.dialogVisible=!1,this.init()}},created:function(){this.init()},watch:{data:function(){this.init()}}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.data?i("div",[i("el-dialog",{attrs:{title:"编辑角色用户",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{attrs:{size:"small","label-width":"80px"}},[i("el-form-item",{attrs:{label:"角色"}},[i("el-input",{staticStyle:{"max-width":"400px"},attrs:{disabled:!0},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"邮箱前缀"}},[i("el-select",{attrs:{multiple:"","default-first-option":"",placeholder:"输入用户邮箱前缀"},model:{value:e.prefix,callback:function(t){e.prefix=t},expression:"prefix"}},e._l(e.data.account,function(e){return i("el-option",{key:e.id,attrs:{label:e.email_prefix,value:e.email_prefix}})}))],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.cancelEvent()}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-edit",title:"编辑",size:"small"},on:{click:function(t){e.setEvent()}}},[i("span",{staticClass:"hidden-xs-only"},[e._v("保存")])])],1)],1),e._v(" "),0===e.data.role_type?i("el-button",{attrs:{type:"primary",icon:"el-icon-edit",title:"编辑",size:"mini"},on:{click:function(t){e.dialogVisible=!0}}},[i("span",{staticClass:"hidden-xs-only"},[e._v("编辑")])]):1===e.data.role_type?i("el-button",{attrs:{type:"primary",title:"查看详情",size:"mini"}},[i("a",{attrs:{href:"/hot/#/category/center/accredit",target:"_blank"}},[e._v("查看详情")])]):e._e()],1):e._e()},staticRenderFns:[]},p=i("VU/8")(f,m,!1,null,null,null).exports,h={name:"roleList",components:{Auth:u.a,OperateRole:p},data:function(){return{apiConf:{getRole:"/role/getRoleList",getUserRole:"/role/getUserRole",addRoleAccount:"/role/addRoleAccount",setRoleAccount:"/role/setRoleAccount",addFieldAccount:"/field/addFieldAccount"},dialogVisible:!1,cateList:null,roleList:null,formAdd:{role_id:1,field_id:"",prefix:"",realname:""},hasRoleAuth:!1,tips:"loading..."}},computed:n()({},Object(d.b)(["pageAuth","email"])),methods:{init:function(){1===this.pageAuth&&this.getUserRole()},getUserRole:function(){var e=this,t={url:this.apiConf.getUserRole,params:{username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)&&t.result&&t.result.permission.indexOf(1)>-1?(e.hasRoleAuth=!0,e.cateList=t.result&&t.result.field||[],e.getRoleList()):e.tips="暂无角色管理页面权限"},function(t){e.tips="接口异常"})},getRoleList:function(){var e=this,t={url:this.apiConf.getRole,params:{username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)?e.roleList=t.result:Object(c.Message)({showClose:!0,message:t.msg||"查询失败!",type:"error",duration:3e3})})},addEvent:function(){3!=this.formAdd.role_id||!isNaN(this.formAdd.field_id)||this.formAdd.field_id?this.formAdd.prefix?this.addHotUser():Object(c.Message)({showClose:!0,message:"请输入用户邮箱前缀！",type:"error",duration:3e3}):Object(c.Message)({showClose:!0,message:"请选择领域业务方！",type:"error",duration:3e3})},addHotUser:function(){var e=this,t={url:"/user/add",params:{userid:this.formAdd.prefix,realname:this.formAdd.realname,type:"2",usergroup:"outer",username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)?e.addAccount():t&&"The data has already existed"==t.msg?e.addAccount():Object(c.Message)({showClose:!0,message:t.msg||"用户添加失败！",type:"error",duration:0})})},addAccount:function(){3==this.formAdd.role_id?this.addFieldAccount():this.addRoleAccount()},addRoleAccount:function(){var e=this,t={url:this.apiConf.addRoleAccount,params:{role_id:this.formAdd.role_id,prefix:this.formAdd.prefix,username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)?(Object(c.Message)({showClose:!0,message:"添加成功!",type:"success",duration:1e3}),e.dialogVisible=!1,e.cancelEvent(),e.getRoleList()):Object(c.Message)({showClose:!0,message:t.msg||"添加失败!",type:"error",duration:0})})},addFieldAccount:function(){var e=this,t={url:this.apiConf.addFieldAccount,params:{field_id:this.formAdd.field_id,prefix:this.formAdd.prefix,username:this.email,cip:230}};this.$store.dispatch("CommonGet",t).then(function(t){t.code&&200==Number(t.code)?(Object(c.Message)({showClose:!0,message:"添加成功!",type:"success",duration:1e3}),e.dialogVisible=!1,e.cancelEvent(),e.getRoleList()):Object(c.Message)({showClose:!0,message:t.msg||"添加失败!",type:"error",duration:0})})},cancelEvent:function(){this.dialogVisible=!1,this.$refs.formAdd.resetFields()},formatEmailList:function(e){if(e&&e.length>0){for(var t=[],i=0;i<e.length;i++)t.push(e[i].email_prefix);return[].concat(o()(new l.a(t))).join("、")}return"暂无"}},created:function(){this.init()},watch:{pageAuth:function(){this.init()}}},b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return 1===e.pageAuth?i("el-main",[i("el-row",{staticClass:"pane-title-wrap"},[i("el-col",{attrs:{span:24}},[i("h6",{staticClass:"pane-title"},[i("i",{staticClass:"el-icon-document hidden-xs-only",staticStyle:{"margin-right":"6px"}}),e._v("角色管理")])])],1),e._v(" "),i("el-row",{staticClass:"content-box-wrap"},[e.hasRoleAuth?i("el-col",{attrs:{span:24}},[i("div",{staticClass:"clearfix",staticStyle:{padding:"10px 0"}},[i("el-button",{staticClass:"left",attrs:{type:"success",size:"mini"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("添加角色用户")])],1),e._v(" "),i("el-dialog",{attrs:{title:"添加角色用户",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"formAdd",attrs:{model:e.formAdd,size:"small"}},[e.roleList?i("el-form-item",{attrs:{prop:"role_id",label:"选择角色","label-width":"120px",required:""}},[i("el-select",{attrs:{placeholder:"请选择角色",filterable:""},model:{value:e.formAdd.role_id,callback:function(t){e.$set(e.formAdd,"role_id",t)},expression:"formAdd.role_id"}},e._l(e.roleList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),e.cateList&&3==e.formAdd.role_id?i("el-form-item",{attrs:{prop:"field_id",label:"选择领域","label-width":"120px",required:""}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择领域"},model:{value:e.formAdd.field_id,callback:function(t){e.$set(e.formAdd,"field_id",t)},expression:"formAdd.field_id"}},e._l(e.cateList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),i("el-form-item",{attrs:{prop:"prefix",label:"邮箱前缀","label-width":"120px",required:""}},[i("el-input",{staticStyle:{"max-width":"400px"},attrs:{placeholder:"输入用户邮箱前缀"},model:{value:e.formAdd.prefix,callback:function(t){e.$set(e.formAdd,"prefix",t)},expression:"formAdd.prefix"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"用户名","label-width":"120px"}},[i("el-input",{staticStyle:{"max-width":"400px"},attrs:{placeholder:"请输入中文名"},model:{value:e.formAdd.realname,callback:function(t){e.$set(e.formAdd,"realname",t)},expression:"formAdd.realname"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.cancelEvent()}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addEvent()}}},[e._v("添 加")])],1)],1),e._v(" "),e.roleList?i("el-row",[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.roleList,border:"",stripe:"",size:"mini"}},[i("el-table-column",{attrs:{fixed:"",align:"left",prop:"name",label:"角色"}}),e._v(" "),i("el-table-column",{attrs:{align:"left",prop:"permission",label:"权限"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.permission,function(t,a){return i("span",{key:a},[e._v("☑"+e._s(t.permission_name)),i("br")])})}}])}),e._v(" "),i("el-table-column",{attrs:{align:"left",prop:"account",label:"邮箱"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.formatEmailList(t.row.account)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"left",prop:"operator",label:"操作人"}}),e._v(" "),i("el-table-column",{attrs:{align:"left",label:"操作项","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("operate-role",{attrs:{data:t.row,callback:e.getRoleList,apiconf:e.apiConf}})]}}])})],1)],1):e._e()],1):i("el-col",{attrs:{span:24}},[i("el-alert",{attrs:{title:e.tips,type:"warning","show-icon":"",closable:!1}})],1)],1)],1):0===e.pageAuth?i("el-main",[i("auth")],1):e._e()},staticRenderFns:[]};var g=i("VU/8")(h,b,!1,function(e){i("oIYh")},"data-v-a639e26c",null);t.default=g.exports},oIYh:function(e,t){}});