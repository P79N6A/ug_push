webpackJsonp([14],{"/WA5":function(e,t){},pDiA:function(e,t){},"w+jj":function(e,t){},zUnc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=a("Dd8w"),o=a.n(n),l=a("NYxO"),r=a("zL8q"),c=a("vzON"),h=a("7t+N"),m=a.n(h),d=a("Rfj3"),u={name:"itemList",props:["item","index"],data:function(){return{adminState:!1,canvas:null,drawImg:!1,painterWidth:25,ogWidth:0,ogHeight:0,canvasHistory:[],canvasOpacity:.5,handOptions:[{value:0,label:"否"},{value:1,label:"是"}],changeOptions:[{value:0,label:"否"},{value:1,label:"是"}],imgMaskUrl:"",imgUrlHeader:"http://10.85.125.60:13141",loading:"",halfWidth:12.5,isFirst:!0,activeState:{hand:"否",change:"否"}}},created:function(){var e=this;this.activeState.hand=this.item.hand_state?"是":"否",this.activeState.change=this.item.change_state?"是":"否",d.b.forEach(function(t,a){t.email==e.email&&(e.adminState=!0)})},computed:o()({maskUrl:function(e){return function(e){return this.methodGetUrl(e)}}},Object(l.b)(["email"])),methods:{imgStateCheck:function(e){var t=this,a={url:"http://10.85.125.60:13141/check_data.json",param:{check_type:e,id:this.item.id,hand_state:this.item.hand_state,change_state:this.item.change_state}},i={data:s()(a),cip:230};this.$store.dispatch("ProxyGet",i).then(function(e){e&&200==e.code?(t.activeState.hand=t.item.hand_state?"是":"否",t.activeState.change=t.item.change_state?"是":"否",Object(r.Message)({showClose:!0,message:e.msg||"成功！",type:"success",duration:1500})):Object(r.Message)({showClose:!0,message:e.msg||"失败",type:"success",duration:1500})},function(e){Object(r.Message)({showClose:!0,message:"接口异常！",type:"error",duration:0})})},openPopup:function(){var e=this;this.$confirm("是否确认下线改组图片","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.checkRow(3)}).catch(function(){e.$message({type:"info",message:"已取消下线"})})},checkEvent:function(e,t,a){var i=this;this.$confirm("确定执行审核操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.checkRow(e,t,a)}).catch(function(){i.$message({type:"info",message:"已取消审核"})})},checkRow:function(e,t,a){var i=this;if(3==e)var n={url:"http://10.85.125.60:13141/check_data.json",param:{check_type:e,id:this.item.id,check_user:this.email}};else n={url:"http://10.85.125.60:13141/check_data.json",param:{check_type:e,id:this.item.id,username:t.username,check_user:this.email}};var o={data:s()(n),cip:230};this.$store.dispatch("ProxyGet",o).then(function(t){t&&200==t.code?3!=e?(Object(r.Message)({showClose:!0,message:t.msg||"审核成功！",type:"success",duration:1500}),1==e?(i.item.info[a].check_type=3,i.item.info[a].check_user=i.email):(i.item.info[a].check_type=2,i.item.info[a].check_user=i.email)):(Object(r.Message)({showClose:!0,message:t.msg||"下线成功！",type:"success",duration:1500}),i.item.isLabel=2):3!=e?Object(r.Message)({showClose:!0,message:t.msg||"审核失败！",type:"error",duration:0}):Object(r.Message)({showClose:!0,message:t.msg||"下线失败！",type:"error",duration:0})},function(e){Object(r.Message)({showClose:!0,message:"接口异常！",type:"error",duration:0})})},methodGetUrl:function(e){return e.indexOf("data:image/jpeg")<0?this.imgUrlHeader+e:e},saveImg:function(){var e=this,t=this,a=new Image;a.src=m()("#box")[0].toDataURL("image/jpeg"),a.onload=function(){a.width=e.ogWidth,a.height=e.ogHeight;var i=document.createElement("canvas"),n=i.getContext("2d");i.width=e.ogWidth,i.height=e.ogHeight,n.drawImage(a,0,0,a.width,a.height),n.scale(1,1);var o=i.toDataURL("image/jpeg"),l={url:"http://10.85.125.60:13141/push_result.json",param:{id:e.item.id,pic_data:o,username:e.email}},c=new URLSearchParams;c.append("data",s()(l)),c.append("cip",230),e.$store.dispatch("ProxyPost",c).then(function(a){if(a&&200==a.code){var i=!0;t.item.info.forEach(function(e,a){e.username==t.email&&(e.mask_url=o,i=!1)}),i&&e.item.info.push({id:e.item.id,mask_url:o,username:e.email,check_user:"",check_type:""}),e.closeDrawImg(),Object(r.Message)({showClose:!1,message:"图片保存成功",type:"success",duration:1e3})}else Object(r.Message)({showClose:!0,message:a.msg||"图片保存失败！",type:"error",duration:0})},function(e){Object(r.Message)({showClose:!0,message:"图片保存接口异常！",type:"error",duration:0})})}},imgLoad:function(){var e=this,t=this,a=m()("#box")[0],i=new Image;i.crossOrigin="anonymous",i.style="opacity: .6;",i.src=this.imgMaskUrl;var s=a.getContext("2d");i.onload=function(){e.loading.close(),e.ogWidth=i.width,e.ogHeight=i.height;var t=m()("#mask-img").width(),n=m()("#mask-img").height();a.width=t,a.height=n,s.drawImage(i,0,0,t,n);s.getImageData(0,0,t,n);e.scale=i.width/t,s.scale(1,1)},s.lineCap="round",s.strokeStyle="#FFFFFF",s.lineWidth=25,this.drawLine(),m()("#blackBtn").click(function(){s.strokeStyle="#000000",m()("#round").css("background","black")}),m()("#whiteBtn").click(function(){s.strokeStyle="#FFFFFF",m()("#round").css("background","#FFFFFF")}),m()("#recallBtn").click(function(){if(e.canvasHistory.length>0){e.painterWidth=e.painterWidth-1,s.clearRect(0,0,a.width,a.height);var t=new Image;t.src=e.canvasHistory[e.canvasHistory.length-1].url,t.onload=function(){e.ogWidth=i.width,e.ogHeight=i.height;var n=m()("#mask-img").width(),o=m()("#mask-img").height();a.width=n,a.height=o,s.drawImage(t,0,0,n,o);s.getImageData(0,0,n,o);e.scale=t.width/n,s.scale(1,1),s.strokeStyle=e.canvasHistory[e.canvasHistory.length-1].color,m()("#round").css("background",e.canvasHistory[e.canvasHistory.length-1].color),e.painterWidth=e.painterWidth+1,e.canvasHistory.pop()}}else Object(r.Message)({showClose:!1,message:"不能再撤销了",type:"error",duration:1e3})}),m()("#clearBtn").click(function(){s.clearRect(0,0,innerWidth,innerHeight),t.painterWidth=25,round.style.borderRadius="50%",round.style.width="25px",round.style.height="25px",t.isFirst=!0,t.canvasHistory=[],m()("#round").css("background","black"),e.imgLoad()})},closeDrawImg:function(){this.painterWidth=25,this.isFirst=!0,this.drawImg=!1,m()("body").css("overflow","auto")},openDrawImg:function(e){this.drawImg=!0,this.canvasHistory=[],this.canvasOpacity=.5,this.halfWidth=12.5,this.isFirst=!0,m()("body").css("overflow","hidden"),this.loading=this.$loading({fullscreen:!0,text:"Loading",background:"rgba(0, 0, 0, 0.8)"}),this.imgMaskUrl=this.methodGetUrl(e)},drawLine:function(){var e=this,t=m()("#box")[0],a=t.getContext("2d"),i=m()("#round")[0];function s(t){var a=t.pageX-m()("#box").offset().left+200,s=t.pageY-m()("#box").offset().top;i.style.display=a<200||s<=0?"none":"block",i.style.left=a-e.halfWidth+"px",i.style.top=s-e.halfWidth+"px"}function n(){i.style.display="none",e.isClear=!1,a.lineCap="round",m()(".draw-img-content").off("mousemove").on("mousemove",s)}function o(t){var s=t.pageX-m()("#box").offset().left,n=t.pageY-m()("#box").offset().top;if(e.isClear)a.clearRect(s-8,n-8,16,16);else{var o=s-e.halfWidth+200,l=n-e.halfWidth;i.style.left=o+"px",i.style.top=l+"px",a.lineCap="round",a.lineJoin="round",a.lineTo(s,n),a.stroke()}}a.lineCap="round",m()("#round").off("mousedown").on("mousedown",function(i){e.isFirst&&(a.lineWidth=e.painterWidth,e.isFirst=!1);if(e.canvasHistory.push({url:t.toDataURL(),color:a.strokeStyle}),!e.isClear){a.beginPath(),a.lineCap="round";var s=i.pageX-m()("#box").offset().left,n=i.pageY-m()("#box").offset().top;a.moveTo(s,n),a.lineTo(s,n),a.stroke()}m()(".draw-img-content").off("mousemove").on("mousemove",o)}),m()("#round").off("mouseup").on("mouseup",n),m()(".draw-img-content").off("mouseleave").on("mouseleave",n),i.style.display="block",i.style.borderRadius="50%",i.style.width="25px",i.style.height="25px",m()(".draw-img-content").off("mousemove").on("mousemove",s)}},mounted:function(){},watch:{canvasOpacity:function(e,t){m()(".canvas-cover").css("opacity",e)},painterWidth:function(e,t){var a=m()("#box")[0].getContext("2d"),i=m()("#round")[0];a.lineWidth=e,this.halfWidth=e/2,i.style.borderRadius=e+"px",i.style.width=e+"px",i.style.height=e+"px"},item:function(){}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.item?a("el-row",[a("el-col",{staticClass:"item-wrapper clearfix",attrs:{span:24}},[a("h3",{staticStyle:{"padding-left":"20px",height:"30px","line-height":"30px"}},[e._v("\n      图"+e._s(e.item.index)+" 点击图片标注\n      "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.item.isLabel&&e.adminState,expression:"item.isLabel == 1 && adminState"}],staticClass:"delete-img",staticStyle:{"background-color":"#909399","border-color":"#909399",color:"#fff","border-radius":"20px"},attrs:{type:"text",round:""},on:{click:e.openPopup}},[e._v("下线")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.item.isLabel&&e.adminState,expression:"item.isLabel == 2 && adminState"}],staticClass:"delete-img",attrs:{type:"info",round:"",plain:"",disabled:""}},[e._v("已下线")])],1),e._v(" "),a("div",{staticClass:"item-select"},[a("span",[e._v("人手分离："),a("span",{staticStyle:{color:"green","white-space":"nowrap"}},[e._v(e._s(e.activeState.hand))])]),e._v(" "),a("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择"},model:{value:e.item.hand_state,callback:function(t){e.$set(e.item,"hand_state",t)},expression:"item.hand_state"}},e._l(e.handOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("span",{staticStyle:{"margin-left":"20px","white-space":"nowrap"}},[e._v("标注更改："),a("span",{staticStyle:{color:"green"}},[e._v(e._s(e.activeState.change))])]),e._v(" "),a("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择"},model:{value:e.item.change_state,callback:function(t){e.$set(e.item,"change_state",t)},expression:"item.change_state"}},e._l(e.changeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px",width:"70px"},attrs:{type:"success",size:"mini",round:""},on:{click:function(t){e.imgStateCheck(5)}}},[e._v("上传")])],1),e._v(" "),a("div",{staticStyle:{position:"relative",display:"flex","flex-wrap":"wrap","margin-top":"20px","padding-bottom":"20px"}},[a("div",{staticClass:"item-img-row"},[a("img",{attrs:{height:"250px;",src:e.imgUrlHeader+e.item.pic_url}}),e._v(" "),a("span",{staticClass:"item-img-row-user"},[e._v("原图")])]),e._v(" "),a("div",{staticClass:"item-img-row",attrs:{id:e.item.id},on:{click:function(t){e.openDrawImg(e.item.mask_url)}}},[a("img",{attrs:{height:"250px;",src:e.imgUrlHeader+e.item.mask_url}}),e._v(" "),a("span",{staticClass:"item-img-row-user"},[e._v("粗掩码")])]),e._v(" "),e._l(e.item.info,function(t,i){return a("div",{key:i,staticClass:"item-img-row",attrs:{id:t.id}},[a("img",{attrs:{height:"250px;",src:e.maskUrl(t.mask_url)},on:{click:function(a){e.openDrawImg(t.mask_url)}}}),e._v(" "),a("span",{staticClass:"item-img-row-user"},[e._v(e._s(t.username))]),e._v(" "),1!=t.check_type?a("div",{staticClass:"item-img-row-check-state"},[3===t.check_type?a("span",{staticClass:"state",staticStyle:{color:"rgb(112,196,66)"}},[e._v("审核通过")]):e._e(),e._v(" "),2===t.check_type?a("span",{staticClass:"state",staticStyle:{color:"rgb(244,111,112)"}},[e._v("审核不通过")]):e._e(),e._v(" "),a("span",{staticClass:"check-user"},[e._v(e._s(t.check_user))])]):e._e(),e._v(" "),e.adminState?a("div",{staticClass:"item-img-row-check"},[a("el-button",{attrs:{type:"primary",round:"",size:"mini"},on:{click:function(a){e.checkEvent(1,t,i)}}},[e._v("通过")]),e._v(" "),a("el-button",{attrs:{type:"danger",round:"",size:"mini"},on:{click:function(a){e.checkEvent(2,t,i)}}},[e._v("不通过")])],1):e._e()])})],2)]),e._v(" "),e.drawImg?a("div",[a("div",{staticClass:"mask"}),e._v(" "),a("i",{staticClass:"el-icon-error close-icon",on:{click:e.closeDrawImg}}),e._v(" "),a("div",{staticClass:"draw-img"},[a("div",{staticClass:"draw-img-content"},[a("div",{staticClass:"btn-wrap"},[a("el-button",{attrs:{type:"primary",id:"blackBtn"}},[e._v("黑笔")]),e._v(" "),a("el-button",{attrs:{type:"primary",id:"whiteBtn"}},[e._v("白笔")]),e._v(" "),a("el-button",{attrs:{type:"primary",id:"recallBtn"}},[e._v("撤回")]),e._v(" "),a("el-button",{attrs:{type:"primary",id:"clearBtn"}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary",id:"saveBtn"},on:{click:e.saveImg}},[e._v("保存")]),e._v(" "),a("el-slider",{staticClass:"range",attrs:{"show-input":"",min:1,max:50},model:{value:e.painterWidth,callback:function(t){e.painterWidth=t},expression:"painterWidth"}}),e._v(" "),a("el-slider",{staticClass:"range",attrs:{"show-input":"",step:.1,min:0,max:1},model:{value:e.canvasOpacity,callback:function(t){e.canvasOpacity=t},expression:"canvasOpacity"}})],1),e._v(" "),a("img",{attrs:{id:"mask-img",src:e.imgUrlHeader+e.item.pic_url,draggable:"false"},on:{load:e.imgLoad}}),e._v(" "),a("div",{staticClass:"round",attrs:{id:"round"}}),e._v(" "),a("canvas",{staticClass:"canvas-cover",attrs:{id:"box"}})])])]):e._e()],1):e._e()},staticRenderFns:[]};var g=a("VU/8")(u,p,!1,function(e){a("w+jj"),a("/WA5")},"data-v-4314472c",null).exports,v={name:"MaterialRecall",components:{Auth:c.a,ItemList:g},data:function(){return{formInline:{id:"",type:"",group:"1,50",page:1,count:10,isLabel:"",checkType:""},change_state:"",hand_state:"",searchName:"",time:"",total:0,list:[],curIndex:1,itemCheckType:""}},computed:o()({showItem:function(){return function(e){return this.getShowItem(e)}}},Object(l.b)(["pageAuth","email"])),methods:{getShowItem:function(e){var t=!0,a=!0;return e.info.forEach(function(e,i){t=2!==e.check_type&&t,a=3!==e.check_type&&a}),2!==this.itemCheckType||(t||a)},init:function(){1===this.pageAuth&&this.onSearch()},onSearch:function(){var e=this;this.itemCheckType=this.formInline.checkType,this.list=[];var t=this.time;t=t||0;var a={url:"http://10.85.125.60:13141/query.json",param:o()({},this.formInline,{time:t,username:this.searchName,change_state:""===this.change_state?-1:this.change_state,hand_state:""===this.hand_state?-1:this.hand_state})},i={data:s()(a),cip:230};this.$store.dispatch("ProxyGet",i).then(function(t){t&&200==t.code?(e.curIndex=Number(e.formInline.group.split(",")[0]),e.list=t.result.data,e.total=t.result.total):Object(r.Message)({showClose:!0,message:t.msg||"图片查询失败！",type:"error",duration:0})},function(e){Object(r.Message)({showClose:!0,message:"图片查询接口异常！",type:"error",duration:0})})},handleSizeChange:function(e){this.formInline.count=e,this.onSearch()},handleCurrentChange:function(e){this.formInline.page=e,this.onSearch()}},created:function(){this.init()},watch:{pageAuth:function(){this.init()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return 1===e.pageAuth?a("el-main",[a("el-row",{staticClass:"pane-title-wrap"},[a("el-col",{attrs:{span:24}},[a("h6",{staticClass:"pane-title"},[e._v("人像分割标注")])])],1),e._v(" "),a("el-row",{staticClass:"search-form-wrap"},[a("el-col",{attrs:{span:24}},[a("el-form",{attrs:{inline:"",model:e.formInline,size:"small"}},[a("el-form-item",{attrs:{label:"图片id"}},[a("el-input",{staticStyle:{"min-width":"290px"},attrs:{placeholder:"请输入图片id",clearable:""},model:{value:e.formInline.id,callback:function(t){e.$set(e.formInline,"id",t)},expression:"formInline.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{staticStyle:{"min-width":"290px"},attrs:{placeholder:"请输入用户名称",clearable:""},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{attrs:{placeholder:"请选择标注类型",clearable:""},model:{value:e.formInline.type,callback:function(t){e.$set(e.formInline,"type",t)},expression:"formInline.type"}},[a("el-option",{attrs:{label:"未标注",value:0}}),e._v(" "),a("el-option",{attrs:{label:"已标注",value:1}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"审核状态"}},[a("el-select",{attrs:{placeholder:"请选择审核状态",clearable:""},model:{value:e.formInline.checkType,callback:function(t){e.$set(e.formInline,"checkType",t)},expression:"formInline.checkType"}},[a("el-option",{attrs:{label:"未审核",value:1}}),e._v(" "),a("el-option",{attrs:{label:"审核未通过",value:2}}),e._v(" "),a("el-option",{attrs:{label:"审核通过",value:3}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"下线状态"}},[a("el-select",{attrs:{placeholder:"请选择下线状态",clearable:""},model:{value:e.formInline.isLabel,callback:function(t){e.$set(e.formInline,"isLabel",t)},expression:"formInline.isLabel"}},[a("el-option",{attrs:{label:"未下线",value:1}}),e._v(" "),a("el-option",{attrs:{label:"已下线",value:2}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"人手分离"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.hand_state,callback:function(t){e.hand_state=t},expression:"hand_state"}},[a("el-option",{attrs:{label:"否",value:0}}),e._v(" "),a("el-option",{attrs:{label:"是",value:1}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"标注更改"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.change_state,callback:function(t){e.change_state=t},expression:"change_state"}},[a("el-option",{attrs:{label:"否",value:0}}),e._v(" "),a("el-option",{attrs:{label:"是",value:1}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"图片范围"}},[a("el-input",{attrs:{placeholder:"图片范围，英文逗号分隔",clearable:""},model:{value:e.formInline.group,callback:function(t){e.$set(e.formInline,"group",t)},expression:"formInline.group"}})],1),e._v(" "),a("el-form-item",[a("el-date-picker",{staticStyle:{"margin-bottom":"5px",width:"170px"},attrs:{type:"date",format:"yyyy年MM月dd日","value-format":"timestamp",placeholder:"选择时间"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSearch}},[a("span",{staticClass:"hidden-xs-only"},[e._v("查询")])])],1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"content-box-wrap"},[e._l(e.list,function(t,i){return a("item-list",{directives:[{name:"show",rawName:"v-show",value:e.showItem(t),expression:"showItem(item)"}],key:i,attrs:{item:t,index:(e.formInline.page-1)*e.formInline.count+i+e.curIndex}})}),e._v(" "),a("div",{staticStyle:{"padding-top":"10px",overflow:"auto"}},[a("el-pagination",{attrs:{"current-page":e.formInline.page,"page-sizes":[5,10,20,50,100,200],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],2)],1):0===e.pageAuth?a("el-main",[a("auth")],1):e._e()},staticRenderFns:[]};var _=a("VU/8")(v,f,!1,function(e){a("pDiA")},"data-v-56704eba",null);t.default=_.exports}});